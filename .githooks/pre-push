#!/usr/bin/env bash
set -euo pipefail

echo "WPMoo Coding Standards pre-push: composer validate, PHPCS"

# Allow hard skip via environment variable
if [ "${WPMOO_SKIP_HOOKS:-0}" = "1" ]; then
  echo "(hooks disabled via WPMOO_SKIP_HOOKS=1)"
  exit 0
fi

if command -v composer >/dev/null 2>&1 && [ -f composer.json ]; then
  # Allow warnings in standards repo; CI also validates non-strict here
  composer validate --no-check-lock --ansi || exit 1
fi

if [ -x vendor/bin/phpcs ]; then
  echo "→ Running PHPCS on WPMoo/ (errors only)"
  if [ -d WPMoo ]; then
    vendor/bin/phpcs -n WPMoo || exit 1
  else
    echo "(WPMoo/ source directory not found, skipping PHPCS scan)"
  fi
fi

echo "✔ Pre-push checks passed"
exit 0
